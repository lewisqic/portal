function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),Upgrade=function(){function e(){_classCallCheck(this,e),this.stripe=Stripe(stripe_config.publishable_key),this.card=null,this.init()}return _createClass(e,[{key:"init",value:function(){this.bindEvents(),this.setupStripe()}},{key:"bindEvents",value:function(){var e=this;$('input[name="installment"]').on("change",function(n){e.handleInstallmentRadioChange()}),$('select[name="plan_id"]').not(".new-plan").on("change",function(n){e.handlePlanIdSelectChange()}),$("select.new-plan").on("change",function(n){e.handleNewPlanSelectChange()}),$("button.submit").on("click",function(n){e.handleSubmitClick()}),$('input[name="payment_method"]').on("change",function(n){e.handlePaymentMethodRadioChange()}),$(".apply-coupon").on("click",function(n){n.preventDefault(),e.applyCoupon()}),$(".remove-coupon").on("click",function(n){n.preventDefault(),e.removeCoupon()})}},{key:"handleInstallmentRadioChange",value:function(){var e=$('input[name="installment"]:checked').attr("data-installment"),n=$('input[name="installment"]:checked').attr("data-price");$(".installment-term").hide(),$('.installment-term[data-installment="'+e+'"]').show(),$(".installment-price").html(n)}},{key:"handlePlanIdSelectChange",value:function(){var e=$('select[name="plan_id"] option:selected').attr("data-price-month"),n=$('select[name="plan_id"] option:selected').attr("data-price-year");$('.plan-price[data-installment="month"]').html(e),$('.plan-price[data-installment="year"]').html(n),$('input[name="installment"][data-installment="month"').attr("data-price",e),$('input[name="installment"][data-installment="year"').attr("data-price",n),this.handleInstallmentRadioChange()}},{key:"handleNewPlanSelectChange",value:function(){var e=parseFloat($(".current-amount").val()),n=$('select[name="plan_id"] option:selected').attr("data-price");if($(".payment-required, .no-payment-required").hide(),void 0!==n){var t=parseFloat(n.replace(/\$/,""));if(t>e){$(".payment-required").show();var a=t-e;$(".total-due-today").html("$"+a.toFixed(2))}else $(".no-payment-required").show();$(".new-plan-price").html("$"+t)}}},{key:"handleSubmitClick",value:function(){var e=this;$("button.submit").button("loading"),$(".error-wrapper").hide(),$("#change_plan_form").length?$("#change_plan_form").submit():$('select[name="company_payment_method_id"]').is(":visible")?e.submitPaymentForm():e.getToken()}},{key:"handlePaymentMethodRadioChange",value:function(){var e=$('input[name="payment_method"]:checked').val();$(".payment-methods-wrapper").hide(),$('.payment-methods-wrapper[data-method="'+e+'"]').show()}},{key:"setupStripe",value:function(){var e=this,n=e.stripe.elements(),t={base:{color:"#495057",fontSize:"16px",lineHeight:"24px",fontFamily:"helvetica, tahoma, calibri, sans-serif"}};$("#card_element").length&&(e.card=n.create("card",{style:t}),e.card.mount("#card_element"),e.card.on("ready",function(){$("button.submit").prop("disabled",!1)}),e.card.addEventListener("change",function(n){n.error?e.setPaymentError(n.error.message):e.setPaymentError()}))}},{key:"getToken",value:function(){var e=this,n=$('input[name="token"]');""===n.val()&&e.stripe.createToken(e.card).then(function(t){t.error?e.setPaymentError(t.error.message):(e.setPaymentError(),n.val(t.token.id),e.submitPaymentForm())})}},{key:"submitPaymentForm",value:function(){var e=this;$(".payment-form").ajaxSubmit({beforeSubmit:function(){},error:function(n,t,a){var o=n.responseJSON&&n.responseJSON.message?n.responseJSON.message:n.responseText?n.responseText:"Oops, something went wrong...";e.setPaymentError(o)},success:function(e){e.route&&(window.location=e.route)}})}},{key:"setPaymentError",value:function(e){$('input[name="token"]').val(""),$(".error-message").html(e),void 0===e?$(".error-wrapper").hide():$(".error-wrapper").show(),void 0!==e&&$("button.submit").button("reset")}},{key:"applyCoupon",value:function(){var e=this,n=$.trim($('input[name="coupon"]').val());if(""===n)return e.setCouponMessage("Please enter a coupon code.","danger"),!1;$.ajax({url:Core.url("verify-coupon"),method:"POST",dataType:"json",data:{code:n},error:function(n,t,a){var o=n.responseJSON&&n.responseJSON.message?n.responseJSON.message:"Unknown error";return e.setCouponStatus("danger",o),!1},beforeSend:function(){e.setCouponStatus()},success:function(n){$(".apply-coupon").hide(),$(".remove-coupon").show(),e.setCouponMessage("Coupon applied successfully.","success")}})}},{key:"removeCoupon",value:function(){var e=this;$('input[name="coupon"]').val(""),$(".remove-coupon").hide(),$(".apply-coupon").show(),e.setCouponMessage("")}},{key:"setCouponMessage",value:function(e,n){$(".coupon-message").html(e).removeClass("text-success text-danger").addClass("text-"+n)}}]),e}();$(function(){new Upgrade});